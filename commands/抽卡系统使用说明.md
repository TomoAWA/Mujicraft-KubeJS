# 🎰 抽卡系统 v4.4 - 使用说明

> **版本更新**：v4.4 新增彩色描述支持、自定义物品显示属性(itemName/itemLore)、完整奖品列表！

## 🎯 这是什么？

一个完全可配置的抽卡系统！你可以创建任意数量的卡池，每个卡池都有独立的抽卡券、概率、保底机制和物品池。

---

## 🚀 快速开始

### 1. 召唤/更新村民
在游戏里执行命令（**需要OP权限**）：
```
/kubejs custom_command gacha_villager
```
这会直接在你脚下生成最新的抽卡商店村民，包含所有已配置的券。

### 2. 重载配置
如果你修改了配置文件，无需重启服务器，直接执行：
```
/kubejs custom_command gacha_reload
```

---

## ⚙️ 配置文件结构

所有配置都在 `kubejs/config/` 目录下：

```
kubejs/config/
├── gacha_settings.json       # 🌍 全局设置（卡池列表、播报、特效）
└── gacha_pools/              # 🎁 卡池配置文件夹
    ├── functional.json       # 物资补给 ✅ 启用
    ├── orbs.json             # 法球寻访 ✅ 启用
    ├── chaos.json            # 混沌邪恶 ✅ 启用
    ├── normal.json           # (测试用，已禁用)
    ├── advanced.json         # (测试用，已禁用)
    ├── legendary.json        # (测试用，已禁用)
    ├── standard.json         # (测试用，已禁用)
    └── anniversary.json      # (测试用，已禁用)
```

---

## 🎁 当前启用的卡池

### 1. 物资补给 (Functional) 💎
**价格**: 32绿宝石/抽 | 4绿宝石块/十连 (9折)
**保底**: 十连至少 2个SR + 1个SSR

| 稀有度 | 概率 | 奖品 |
|--------|------|------|
| **SSR** | 10% | 模拟凝胶、狱火锭、传奇墨水、下界之星×2 |
| **SR** | 40% | 海洋之心、炽燃余烬、不死图腾、凋灵黑曜石锭、回响碎片、潜影壳×2、海绵×4、下界合金碎片×2 |
| **R** | 50% | 奥术源质×8、空白符文×4、绯红钕锭×2、湛蓝钕锭×2、龙息×2、钻石×4、绿宝石×8、恶魂之泪×4、幻翼膜×8、末影珍珠×16、烈焰棒×8、粘液球×16、火药×32 |

**特点**: **无垃圾！** N卡概率为0，最低也是R卡起步！

---

### 2. 法球寻访 (Orbs) 🔮
**价格**: 3钻石/抽 | 27钻石/十连 (9折)
**保底**: 无需保底，100%出法球！

| 稀有度 | 概率 | 奖品 |
|--------|------|------|
| **Orb** | 100% | 炽焰、冰霜、雷霆、神圣、末影、猩红、唤魔、自然、法力、冷却缩减、抗性 (共11种升级法球) |

**特点**: **只出法球！** Iron's Spells 玩家专享，每抽必得一个升级法球！

---

### 3. 混沌邪恶 (Chaos) 💀
**价格**: 8铁锭/抽 | 8铁块/十连
**保底**: **无！** 这是个玩具池！

| 稀有度 | 概率 | 奖品 |
|--------|------|------|
| **SSR** | 1% | GM权杖(命令方块)、空气墙(屏障)、传家宝(基岩)、真正的虚空、拼图方块 |
| **SR** | 9% | 坏掉的表、虽然但是(指南针)、至尊土豪锄、姜太公的鱼竿 |
| **R** | 30% | 传说之杖(耐久2木棍)、无字天书、减肥圣水(空玻璃瓶)、一次性神器(破木锄)、金牙 |
| **N** | 60% | 普通的泥土、枯萎的希望、特级厨师晚餐(毒马铃薯)、陈年牛肉干(腐肉)、非常圆的圆石、断掉的剑柄、凤凰羽毛(鸡毛) |

**特点**: **没有任何实用价值！** 只为了图一乐。所有物品都有搞笑的自定义名称和描述！

---

## 📖 如何新建一个卡池？

只需简单的三步，不需要写任何代码！

### 第 1 步：创建配置文件
在 `kubejs/config/gacha_pools/` 下创建一个新的 JSON 文件，例如 `mypool.json`。

**文件模板**：
```json
{
  "_bannerName": "我的自定义寻访",
  
  "tickets": {
    "single": {
      "type": "mypool",
      "name": "【自定义】单抽券",
      "color": "red",
      "lore": [
        {"text": "=== 我的卡池 ===", "color": "red"},
        {"text": "SSR概率: 5%", "color": "gold"},
        {"text": "有好东西！", "color": "yellow"}
      ],
      "price": { "item": "minecraft:diamond", "count": 1 }
    },
    "multi": {
      "type": "mypool_10",
      "name": "【自定义】十连券",
      "color": "red",
      "bold": true,
      "lore": [
        {"text": "保底SSR！", "color": "gold"}
      ],
      "price": { "item": "minecraft:diamond", "count": 9 }
    }
  },
  
  "rates": { "N": 40, "R": 40, "SR": 15, "SSR": 5 },
  
  "guarantees": {
    "minRarity": "SSR"
  },
  
  "pools": {
    "N": [ { "item": "minecraft:dirt", "count": 1, "name": "泥土" } ],
    "R": [ { "item": "minecraft:iron_ingot", "count": 1, "name": "铁锭" } ],
    "SR": [ { "item": "minecraft:diamond", "count": 1, "name": "钻石" } ],
    "SSR": [ { "item": "minecraft:netherite_ingot", "count": 1, "name": "下界合金锭" } ]
  }
}
```

### 第 2 步：注册卡池
打开 `kubejs/config/gacha_settings.json`，在 `"banners"` 列表中添加你的文件名（不带 .json）：

```json
  "banners": [
    "functional",
    "orbs",
    "chaos",
    "mypool"  <-- 添加这一行
  ],
```

### 第 3 步：应用更改
在游戏里执行：
1. `/kubejs custom_command gacha_reload` （重载配置）
2. `/kubejs custom_command gacha_kill` （清除旧村民）
3. `/kubejs custom_command gacha_villager` （生成新村民）

搞定！新村民现在会卖你的自定义抽卡券了！

---

## ✨ 高级功能

### 彩色描述 (Lore)
抽卡券的描述支持彩色格式：

```json
"lore": [
  {"text": "SSR概率: 10%", "color": "gold"},
  {"text": "SR概率: 40%", "color": "light_purple"},
  {"text": "R概率: 50%", "color": "blue"},
  "普通灰色文本也可以"
]
```

**可用颜色**: `black`, `dark_blue`, `dark_green`, `dark_aqua`, `dark_red`, `dark_purple`, `gold`, `gray`, `dark_gray`, `blue`, `green`, `aqua`, `red`, `light_purple`, `yellow`, `white`

### 自定义物品显示 (itemName/itemLore)
在奖品对象中添加 `itemName` 和 `itemLore` 可以修改物品本身的名称和描述：

```json
{
  "item": "minecraft:stick",
  "count": 1,
  "name": "传说之杖",           // 聊天显示用
  "itemName": "传说之杖",      // 物品实际名称（黄色）
  "itemLore": [                // 物品实际描述（灰色斜体）
    "耐久: 2 / ∞",
    "攻击力: 0.1"
  ],
  "nbt": "{Enchantments:[{id:\"minecraft:unbreaking\",lvl:1}]}"
}
```

- `name` - 仅用于聊天显示（"恭喜获得 XXX"）
- `itemName` - 修改物品实际名称（可选）
- `itemLore` - 修改物品实际描述（可选）

这样可以让混沌池的"传说之杖"真的显示这个名字和描述！

### 全服播报
在 `gacha_settings.json` 中配置：
```json
"broadcast": {
  "enabled": true,
  "rarities": ["SSR", "新春限定", "UP"],
  "messagePrefix": "★ ",
  "messageSuffix": " ★"
}
```

### 抽卡特效（声音与粒子）
```json
"rarityEffects": {
  "SSR": {
    "sound": "minecraft:ui.toast.challenge_complete",
    "particle": "minecraft:totem_of_undying",
    "particleCount": 50
  }
}
```

---

## 🛠️ 管理命令 (OP Only)

| 命令 | 功能 |
|------|------|
| `/kubejs custom_command gacha_reload` | 重载所有配置文件 |
| `/kubejs custom_command gacha_villager` | 在脚下生成包含所有券的村民 |
| `/kubejs custom_command gacha_kill` | **立刻清除** 附近的抽卡商店村民 |
| `/kubejs custom_command gacha_list` | (所有玩家可用) 列出当前加载的卡池 |

---

## ❓ 常见问题

### Q: 十连券是一次抽10次吗？
A: 是的！而且如果你在一次十连中抽到了多个金（比如双黄蛋），**全服播报会把它们全部都播报出来**！让大家都来吸欧气！

### Q: 我添加了卡池文件，但重载后没反应？
A: 别忘了在 `gacha_settings.json` 的 `"banners"` 列表里把文件名加上去！

### Q: 怎么修改概率？
A: 直接修改对应卡池 JSON 文件里的 `"rates"` 字段。

### Q: 怎么给物品加附魔？
A: 在物品对象里添加 `"nbt"` 字符串：
```json
{
  "item": "minecraft:enchanted_book",
  "name": "强力附魔书",
  "nbt": "{StoredEnchantments:[{id:\"minecraft:sharpness\",lvl:5}]}"
}
```
**注意**：NBT 必须是**字符串**格式（用双引号包起来，里面的双引号要用 `\` 转义）！

### Q: 怎么禁用某个卡池？
A: 在 `gacha_settings.json` 的 `"banners"` 列表中删除对应的文件名即可。配置文件不需要删除，可以留着以后重新启用。

---

**祝你玩得开心！** 🎰
